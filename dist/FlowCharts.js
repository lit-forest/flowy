!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t=t||self).FlowCharts={})}(this,function(t){"use strict";function o(t,n){for(var r=0;r<n.length;r++){var e=n[r];e.enumerable=e.enumerable||!1,e.configurable=!0,"value"in e&&(e.writable=!0),Object.defineProperty(t,e.key,e)}}function n(n,t){var r=Object.keys(n);if(Object.getOwnPropertySymbols){var e=Object.getOwnPropertySymbols(n);t&&(e=e.filter(function(t){return Object.getOwnPropertyDescriptor(n,t).enumerable})),r.push.apply(r,e)}return r}function i(o){for(var t=1;t<arguments.length;t++){var i=null!=arguments[t]?arguments[t]:{};t%2?n(Object(i),!0).forEach(function(t){var n,r,e;n=o,e=i[r=t],r in n?Object.defineProperty(n,r,{value:e,enumerable:!0,configurable:!0,writable:!0}):n[r]=e}):Object.getOwnPropertyDescriptors?Object.defineProperties(o,Object.getOwnPropertyDescriptors(i)):n(Object(i)).forEach(function(t){Object.defineProperty(o,t,Object.getOwnPropertyDescriptor(i,t))})}return o}function u(t,n){return function(t){if(Array.isArray(t))return t}(t)||function(t,n){if(!(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t)))return;var r=[],e=!0,o=!1,i=void 0;try{for(var u,c=t[Symbol.iterator]();!(e=(u=c.next()).done)&&(r.push(u.value),!n||r.length!==n);e=!0);}catch(t){o=!0,i=t}finally{try{e||null==c.return||c.return()}finally{if(o)throw i}}return r}(t,n)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function a(t){return function(t){if(Array.isArray(t)){for(var n=0,r=new Array(t.length);n<t.length;n++)r[n]=t[n];return r}}(t)||function(t){if(Symbol.iterator in Object(t)||"[object Arguments]"===Object.prototype.toString.call(t))return Array.from(t)}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function r(t){return function r(o,i){return function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];return e.length>=o?i.apply(void 0,e):r(o-e.length,function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return i.apply(void 0,e.concat(n))})}}(t.length,t)}function e(e){for(var t=arguments.length,o=new Array(1<t?t-1:0),n=1;n<t;n++)o[n-1]=arguments[n];return function(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.apply(void 0,o.concat(n))}}function c(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return function(t){return n.reduceRight(function(t,n){return n(t)},t)}}function s(){}function f(n){return{map:function(t){return f(function(){return t(n())})},chain:function(t){return f(function(){return t(n()).run()})},fold:function(t){return t(n())},run:function(){return n()}}}function l(r){return{chain:function(t){return t(r)},map:function(t){return l(t(r))},flod:function(t,n){return n(r)},concat:function(t){return t.flod(function(t){return x(t)},function(t){return l(r.concat(t))})},isLeft:!1,isRight:!0}}var p,h="http://www.w3.org/2000/svg",d=[["id","flow-svg"],["style","position:absolute;top:0;left:0"]],b=[["xmlns:xlink","http://www.w3.org/1999/xlink","http://www.w3.org/2000/xmlns/"]],y=[["viewBox","0 0 10 10"],["refX","5"],["refY","5"],["markerUnits","strokeWidth"],["markerWidth","10"],["markerHeight","8"],["orient","auto"],["fill","#333"]],v=[["d","M 0 0 L 10 5 L 0 10 z"]],m=[["cx",5,null],["cy",5,null],["r",5,null],["fill","#333",null]],w=[["fill","none"],["marker-start","url(#circle)"],["marker-end","url(#triangle)"]],g=r(function(t,n,r){return t(r)?n(r):f(s)}),_={IO:f,ioWhen:g,of:f},x=function t(n){return{chain:function(){return t(n)},map:function(){return t(n)},flod:function(t){return t(n)},concat:function(){return t(n)},isLeft:!0,isRight:!1}},E=r(function(t,n,r){return r.flod(t,n)}),S={Right:l,Left:x,fromNullable:function(t){return(null!=t?l:x)(t)},tryCatch:function(t){try{return l(t())}catch(t){return x(t)}},either:E,of:l},O=(p=_,k.of=function(t){return k(p.of(l(t)))},k);function k(t){return{runEitherT:t,chain:function(n){return k(t.chain(E(function(t){return p.of(function(){return x(t)})},function(t){return n(t).runEitherT})))}}}function L(t){return O(t.map(S.Right))}function T(t){return t.runEitherT.run()}function P(t,n,r){var e="one"===n?t.querySelector(r):t.querySelectorAll(r);return e||e&&e.length?S.Right(e):S.Left("Error: Could not find DOM Node with selector '".concat(r,"'"))}function A(t){return _.of(function(){return C(t)})}function D(t,n){return T(O(A(t)).chain(c(L,(r=n,function(n){return _.of(function(){Array.isArray(r)?r.forEach(function(t){return n.appendChild(t)}):n.appendChild(r)})}))));var r}function j(t){return _.of(function(){return t.remove()})}function I(t){return T(O(A(t)).chain(c(L,j)))}function N(t){var n=t.getBoundingClientRect(),r=document.documentElement,e=n.left+(window.pageXOffset||r.scrollLeft)-(r.clientLeft||document.body.clientLeft||0),o=n.top+(window.pageYOffset||r.scrollTop)-(r.clientTop||document.body.clientTop||0);return{left:e,top:o,right:e+n.width,bottom:o+n.height}}var C=e(P,document,"one"),B=(e(P,document,"all"),r(function(t,n,r,e){var o=document.createDocumentFragment(),i=document.createElementNS(t,n);return Array.isArray(e)&&r.forEach(function(t){var n=u(t,2),r=n[0],e=n[1];return i.setAttribute(r,e)}),Array.isArray(e)&&e.forEach(function(t){var n=u(t,3),r=n[0],e=n[1],o=n[2];return i.setAttributeNS(o,r,e)}),o.appendChild(i)})),U=r(function(t,n){var r=N(t),e=r.left,o=r.top,i=r.right,u=r.bottom,c=N(n),s=c.left,a=c.top,f=c.right,l=c.bottom;return e<=s&&f<=i&&o<=a&&l<=u});function Y(t){var n=t.getBoundingClientRect(),r=n.top,e=n.left,o=n.right,i=n.bottom;return{x:e+(n.width||o-e)/2,y:r+(n.height||i-r)/2}}function H(t){return E(s,s)(X(t,F()))}function M(u){return function(i){return _.of(function(){var t,n,r,e,o;R(u,(t=i.getBoundingClientRect(),n=t.top,r=t.bottom,e=t.left,o=t.right,{height:t.height||r-n,width:t.width||o-e})),i.appendChild(u)})}}function V(t,n,r,e,o,i,u){var c=5<arguments.length&&void 0!==i?i:"#333",s=6<arguments.length&&void 0!==u?u:.5;z(t),D("#".concat("flow-svg"),W(t,n,r,e,o,c,s))}var X=function(t,n){return T(O(A(t)).chain(c(L,M(n))))},R=function(t,n){var r=n.width,e=n.height;t.setAttributeNS(null,"viewBox","0 0 "+r+" "+e),t.setAttributeNS(null,"width",r),t.setAttributeNS(null,"height",e)},F=function(){var t=B(h,"svg",d,b),n=q("triangle","path",v),r=q("circle","circle",m);return t.append(n),t.append(r),t},q=function(t,n,r,e){var o=2<arguments.length&&void 0!==r?r:[],i=3<arguments.length&&void 0!==e?e:[],u=B(h,"defs",[],[]),c=B(h,"marker",[["id",t]].concat(a(y)),[]),s=B("http://www.w3.org/2000/svg",n,o,i);return c.append(s),u.append(c),u},W=function(t,n,r,e,o,i,u){return B(h,"path")([],[["id",t],["d",J(n,r,e,o,u)],["stroke",i]].concat(a(w)))},J=function(t,n,r,e,o){var i=(e-n)*o;return"M "+t+" "+n+" C "+t+" "+(n+i)+" "+r+" "+(e-i)+" "+r+" "+e},z=function(t){return I("#".concat(t))},G=function(t,n){return(G=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var r in n)n.hasOwnProperty(r)&&(t[r]=n[r])})(t,n)};function K(t,n){function r(){this.constructor=t}G(t,n),t.prototype=null===n?Object.create(n):(r.prototype=n.prototype,new r)}function Q(t){return"function"==typeof t}var Z=!1,$={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;Z=t},get useDeprecatedSynchronousErrorHandling(){return Z}};function tt(t){setTimeout(function(){throw t},0)}var nt={closed:!0,next:function(t){},error:function(t){if($.useDeprecatedSynchronousErrorHandling)throw t;tt(t)},complete:function(){}},rt=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();function et(t){return null!==t&&"object"==typeof t}var ot=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,n){return n+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),it=function(){function c(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var t;return c.prototype.unsubscribe=function(){var n;if(!this.closed){var t=this._parentOrParents,r=this._unsubscribe,e=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,t instanceof c)t.remove(this);else if(null!==t)for(var o=0;o<t.length;++o){t[o].remove(this)}if(Q(r))try{r.call(this)}catch(t){n=t instanceof ot?ut(t.errors):[t]}if(rt(e)){o=-1;for(var i=e.length;++o<i;){var u=e[o];if(et(u))try{u.unsubscribe()}catch(t){n=n||[],t instanceof ot?n=n.concat(ut(t.errors)):n.push(t)}}}if(n)throw new ot(n)}},c.prototype.add=function(t){var n=t;if(!t)return c.EMPTY;switch(typeof t){case"function":n=new c(t);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof c)){var r=n;(n=new c)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+t+" added to Subscription.")}var e=n._parentOrParents;if(null===e)n._parentOrParents=this;else if(e instanceof c){if(e===this)return n;n._parentOrParents=[e,this]}else{if(-1!==e.indexOf(this))return n;e.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},c.prototype.remove=function(t){var n=this._subscriptions;if(n){var r=n.indexOf(t);-1!==r&&n.splice(r,1)}},c.EMPTY=((t=new c).closed=!0,t),c}();function ut(t){return t.reduce(function(t,n){return t.concat(n instanceof ot?n.errors:n)},[])}var ct=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),st=function(o){function i(t,n,r){var e=o.call(this)||this;switch(e.syncErrorValue=null,e.syncErrorThrown=!1,e.syncErrorThrowable=!1,e.isStopped=!1,arguments.length){case 0:e.destination=nt;break;case 1:if(!t){e.destination=nt;break}if("object"==typeof t){t instanceof i?(e.syncErrorThrowable=t.syncErrorThrowable,(e.destination=t).add(e)):(e.syncErrorThrowable=!0,e.destination=new at(e,t));break}default:e.syncErrorThrowable=!0,e.destination=new at(e,t,n,r)}return e}return K(i,o),i.prototype[ct]=function(){return this},i.create=function(t,n,r){var e=new i(t,n,r);return e.syncErrorThrowable=!1,e},i.prototype.next=function(t){this.isStopped||this._next(t)},i.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},i.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},i.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,o.prototype.unsubscribe.call(this))},i.prototype._next=function(t){this.destination.next(t)},i.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},i.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},i.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},i}(it),at=function(c){function t(t,n,r,e){var o,i=c.call(this)||this;i._parentSubscriber=t;var u=i;return Q(n)?o=n:n&&(o=n.next,r=n.error,e=n.complete,n!==nt&&(Q((u=Object.create(n)).unsubscribe)&&i.add(u.unsubscribe.bind(u)),u.unsubscribe=i.unsubscribe.bind(i))),i._context=u,i._next=o,i._error=r,i._complete=e,i}return K(t,c),t.prototype.next=function(t){if(!this.isStopped&&this._next){var n=this._parentSubscriber;$.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},t.prototype.error=function(t){if(!this.isStopped){var n=this._parentSubscriber,r=$.useDeprecatedSynchronousErrorHandling;if(this._error)r&&n.syncErrorThrowable?this.__tryOrSetError(n,this._error,t):this.__tryOrUnsub(this._error,t),this.unsubscribe();else if(n.syncErrorThrowable)r?(n.syncErrorValue=t,n.syncErrorThrown=!0):tt(t),this.unsubscribe();else{if(this.unsubscribe(),r)throw t;tt(t)}}},t.prototype.complete=function(){var t=this;if(!this.isStopped){var n=this._parentSubscriber;if(this._complete){var r=function(){return t._complete.call(t._context)};$.useDeprecatedSynchronousErrorHandling&&n.syncErrorThrowable?this.__tryOrSetError(n,r):this.__tryOrUnsub(r),this.unsubscribe()}else this.unsubscribe()}},t.prototype.__tryOrUnsub=function(t,n){try{t.call(this._context,n)}catch(t){if(this.unsubscribe(),$.useDeprecatedSynchronousErrorHandling)throw t;tt(t)}},t.prototype.__tryOrSetError=function(n,t,r){if(!$.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{t.call(this._context,r)}catch(t){return $.useDeprecatedSynchronousErrorHandling?(n.syncErrorValue=t,n.syncErrorThrown=!0):(tt(t),!0)}return!1},t.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},t}(st);var ft=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function lt(){}var pt=function(){function r(t){this._isScalar=!1,t&&(this._subscribe=t)}return r.prototype.lift=function(t){var n=new r;return n.source=this,n.operator=t,n},r.prototype.subscribe=function(t,n,r){var e=this.operator,o=function(t,n,r){if(t){if(t instanceof st)return t;if(t[ct])return t[ct]()}return t||n||r?new st(t,n,r):new st(nt)}(t,n,r);if(e?o.add(e.call(o,this.source)):o.add(this.source||$.useDeprecatedSynchronousErrorHandling&&!o.syncErrorThrowable?this._subscribe(o):this._trySubscribe(o)),$.useDeprecatedSynchronousErrorHandling&&o.syncErrorThrowable&&(o.syncErrorThrowable=!1,o.syncErrorThrown))throw o.syncErrorValue;return o},r.prototype._trySubscribe=function(n){try{return this._subscribe(n)}catch(t){$.useDeprecatedSynchronousErrorHandling&&(n.syncErrorThrown=!0,n.syncErrorValue=t),!function(t){for(;t;){var n=t.closed,r=t.destination,e=t.isStopped;if(n||e)return!1;t=r&&r instanceof st?r:null}return!0}(n)?console.warn(t):n.error(t)}},r.prototype.forEach=function(e,t){var o=this;return new(t=ht(t))(function(t,n){var r;r=o.subscribe(function(t){try{e(t)}catch(t){n(t),r&&r.unsubscribe()}},n,t)})},r.prototype._subscribe=function(t){var n=this.source;return n&&n.subscribe(t)},r.prototype[ft]=function(){return this},r.prototype.pipe=function(){for(var n,t=[],r=0;r<arguments.length;r++)t[r]=arguments[r];return 0===t.length?this:((n=t)?1===n.length?n[0]:function(t){return n.reduce(function(t,n){return n(t)},t)}:lt)(this)},r.prototype.toPromise=function(t){var e=this;return new(t=ht(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},r.create=function(t){return new r(t)},r}();function ht(t){if(!(t=t||Promise))throw new Error("no Promise impl found");return t}function dt(n,r){return function(t){if("function"!=typeof n)throw new TypeError("argument is not a function. Are you looking for `mapTo()`?");return t.lift(new bt(n,r))}}var bt=function(){function t(t,n){this.project=t,this.thisArg=n}return t.prototype.call=function(t,n){return n.subscribe(new yt(t,this.project,this.thisArg))},t}(),yt=function(o){function t(t,n,r){var e=o.call(this,t)||this;return e.project=n,e.count=0,e.thisArg=r||e,e}return K(t,o),t.prototype._next=function(t){var n;try{n=this.project.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}this.destination.next(n)},t}(st),vt=function(t){function n(){return null!==t&&t.apply(this,arguments)||this}return K(n,t),n.prototype.notifyNext=function(t,n,r,e,o){this.destination.next(n)},n.prototype.notifyError=function(t,n){this.destination.error(t)},n.prototype.notifyComplete=function(t){this.destination.complete()},n}(st),mt=function(o){function t(t,n,r){var e=o.call(this)||this;return e.parent=t,e.outerValue=n,e.outerIndex=r,e.index=0,e}return K(t,o),t.prototype._next=function(t){this.parent.notifyNext(this.outerValue,t,this.outerIndex,this.index++,this)},t.prototype._error=function(t){this.parent.notifyError(t,this),this.unsubscribe()},t.prototype._complete=function(){this.parent.notifyComplete(this),this.unsubscribe()},t}(st);function wt(){return"function"==typeof Symbol&&Symbol.iterator?Symbol.iterator:"@@iterator"}var gt=wt(),_t=function(t){return t&&"number"==typeof t.length&&"function"!=typeof t};function xt(t){return!!t&&"function"!=typeof t.subscribe&&"function"==typeof t.then}var Et=function(t){if(t&&"function"==typeof t[ft])return i=t,function(t){var n=i[ft]();if("function"!=typeof n.subscribe)throw new TypeError("Provided object does not correctly implement Symbol.observable");return n.subscribe(t)};if(_t(t))return o=t,function(t){for(var n=0,r=o.length;n<r&&!t.closed;n++)t.next(o[n]);t.complete()};if(xt(t))return r=t,function(n){return r.then(function(t){n.closed||(n.next(t),n.complete())},function(t){return n.error(t)}).then(null,tt),n};if(t&&"function"==typeof t[gt])return e=t,function(t){for(var n=e[gt]();;){var r=n.next();if(r.done){t.complete();break}if(t.next(r.value),t.closed)break}return"function"==typeof n.return&&t.add(function(){n.return&&n.return()}),t};var e,r,o,i,n=et(t)?"an invalid object":"'"+t+"'";throw new TypeError("You provided "+n+" where a stream was expected. You can provide an Observable, Promise, Array, or Iterable.")};function St(t,n,r,e,o){if(void 0===o&&(o=new mt(t,r,e)),!o.closed)return n instanceof pt?n.subscribe(o):Et(n)(o)}function Ot(t,n){if(null!=t){if((a=t)&&"function"==typeof a[ft])return c=t,s=n,new pt(function(n){var r=new it;return r.add(s.schedule(function(){var t=c[ft]();r.add(t.subscribe({next:function(t){r.add(s.schedule(function(){return n.next(t)}))},error:function(t){r.add(s.schedule(function(){return n.error(t)}))},complete:function(){r.add(s.schedule(function(){return n.complete()}))}}))})),r});if(xt(t))return i=t,u=n,new pt(function(n){var r=new it;return r.add(u.schedule(function(){return i.then(function(t){r.add(u.schedule(function(){n.next(t),r.add(u.schedule(function(){return n.complete()}))}))},function(t){r.add(u.schedule(function(){return n.error(t)}))})})),r});if(_t(t))return e=t,o=n,new pt(function(t){var n=new it,r=0;return n.add(o.schedule(function(){r!==e.length?(t.next(e[r++]),t.closed||n.add(this.schedule())):t.complete()})),n});if((r=t)&&"function"==typeof r[gt]||"string"==typeof t)return function(n,r){if(!n)throw new Error("Iterable cannot be null");return new pt(function(e){var o,t=new it;return t.add(function(){o&&"function"==typeof o.return&&o.return()}),t.add(r.schedule(function(){o=n[gt](),t.add(r.schedule(function(){if(!e.closed){var t,n;try{var r=o.next();t=r.value,n=r.done}catch(t){return void e.error(t)}n?e.complete():(e.next(t),this.schedule())}}))})),t})}(t,n)}var r,e,o,i,u,c,s,a;throw new TypeError((null!==t&&typeof t||t)+" is not observable")}function kt(o,i,n){return void 0===n&&(n=Number.POSITIVE_INFINITY),"function"==typeof i?function(t){return t.pipe(kt(function(r,e){return(t=o(r,e),n?Ot(t,n):t instanceof pt?t:new pt(Et(t))).pipe(dt(function(t,n){return i(r,t,e,n)}));var t,n},n))}:("number"==typeof i&&(n=i),function(t){return t.lift(new Lt(o,n))})}var Lt=function(){function t(t,n){void 0===n&&(n=Number.POSITIVE_INFINITY),this.project=t,this.concurrent=n}return t.prototype.call=function(t,n){return n.subscribe(new Tt(t,this.project,this.concurrent))},t}(),Tt=function(o){function t(t,n,r){void 0===r&&(r=Number.POSITIVE_INFINITY);var e=o.call(this,t)||this;return e.project=n,e.concurrent=r,e.hasCompleted=!1,e.buffer=[],e.active=0,e.index=0,e}return K(t,o),t.prototype._next=function(t){this.active<this.concurrent?this._tryNext(t):this.buffer.push(t)},t.prototype._tryNext=function(t){var n,r=this.index++;try{n=this.project(t,r)}catch(t){return void this.destination.error(t)}this.active++,this._innerSub(n,t,r)},t.prototype._innerSub=function(t,n,r){var e=new mt(this,n,r),o=this.destination;o.add(e);var i=St(this,t,void 0,void 0,e);i!==e&&o.add(i)},t.prototype._complete=function(){this.hasCompleted=!0,0===this.active&&0===this.buffer.length&&this.destination.complete(),this.unsubscribe()},t.prototype.notifyNext=function(t,n,r,e,o){this.destination.next(n)},t.prototype.notifyComplete=function(t){var n=this.buffer;this.remove(t),this.active--,0<n.length?this._next(n.shift()):0===this.active&&this.hasCompleted&&this.destination.complete()},t}(vt);function Pt(t,r,e,n){return Q(e)&&(n=e,e=void 0),n?Pt(t,r,e).pipe(dt(function(t){return rt(t)?n.apply(void 0,t):n(t)})):new pt(function(n){!function t(n,r,e,o,i){var u;if(d=n,d&&"function"==typeof d.addEventListener&&"function"==typeof d.removeEventListener){var c=n;n.addEventListener(r,e,i),u=function(){return c.removeEventListener(r,e,i)}}else if(h=n,h&&"function"==typeof h.on&&"function"==typeof h.off){var s=n;n.on(r,e),u=function(){return s.off(r,e)}}else if(p=n,p&&"function"==typeof p.addListener&&"function"==typeof p.removeListener){var a=n;n.addListener(r,e),u=function(){return a.removeListener(r,e)}}else{if(!n||!n.length)throw new TypeError("Invalid event target");for(var f=0,l=n.length;f<l;f++)t(n[f],r,e,o,i)}var p;var h;var d;o.add(u)}(t,r,function(t){1<arguments.length?n.next(Array.prototype.slice.call(arguments)):n.next(t)},n,e)})}var At=function(){function t(t,n){this.predicate=t,this.thisArg=n}return t.prototype.call=function(t,n){return n.subscribe(new Dt(t,this.predicate,this.thisArg))},t}(),Dt=function(o){function t(t,n,r){var e=o.call(this,t)||this;return e.predicate=n,e.thisArg=r,e.count=0,e}return K(t,o),t.prototype._next=function(t){var n;try{n=this.predicate.call(this.thisArg,t,this.count++)}catch(t){return void this.destination.error(t)}n&&this.destination.next(t)},t}(st);function jt(n){return function(t){return t.lift(new It(n))}}var It=function(){function t(t){this.notifier=t}return t.prototype.call=function(t,n){var r=new Nt(t),e=St(r,this.notifier);return e&&!r.seenValue?(r.add(e),n.subscribe(r)):r},t}(),Nt=function(r){function t(t){var n=r.call(this,t)||this;return n.seenValue=!1,n}return K(t,r),t.prototype.notifyNext=function(t,n,r,e,o){this.seenValue=!0,this.complete()},t.prototype.notifyComplete=function(){},t}(vt);function Ct(n,r,e){return function(t){return t.lift(new Yt(n,r,e))}}function Bt(t){return t+(new Date).getTime()}function Ut(t){H(t);var n=new Mt(t);return{output:function(){return{blockList:JSON.stringify(n.tempBlockList),lineList:JSON.stringify(n.lineList),html:n.canvas.innerHTML}},import:function(t){return n.import(t)},clear:function(){n.tempBlockList.map(function(t){var n=t.id;return I("#".concat(n))}),n.lineList.map(function(t){var n=t.id;return I("#".concat(n))}),n.tempBlockList=[],n.lineList=[]}}}var Yt=function(){function t(t,n,r){this.nextOrObserver=t,this.error=n,this.complete=r}return t.prototype.call=function(t,n){return n.subscribe(new Ht(t,this.nextOrObserver,this.error,this.complete))},t}(),Ht=function(i){function t(t,n,r,e){var o=i.call(this,t)||this;return o._tapNext=lt,o._tapError=lt,o._tapComplete=lt,o._tapError=r||lt,o._tapComplete=e||lt,Q(n)?(o._context=o)._tapNext=n:n&&(o._context=n,o._tapNext=n.next||lt,o._tapError=n.error||lt,o._tapComplete=n.complete||lt),o}return K(t,i),t.prototype._next=function(t){try{this._tapNext.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.next(t)},t.prototype._error=function(t){try{this._tapError.call(this._context,t)}catch(t){return void this.destination.error(t)}this.destination.error(t)},t.prototype._complete=function(){try{this._tapComplete.call(this._context)}catch(t){return void this.destination.error(t)}return this.destination.complete()},t}(st),Mt=function(){function n(t){!function(t,n){if(!(t instanceof n))throw new TypeError("Cannot call a class as a function")}(this,n),this.canvas=document.querySelector(t),this.tempBlockList=[],this.lineList=[],this.currPathUUID=null,this.parentId=null,this.blockMouseDown=this.blockMouseDown.bind(this),this.handleTempBlcokDrag=this.handleTempBlcokDrag.bind(this),this.handlePointDrag=this.handlePointDrag.bind(this),this.draggableBlocks=a(document.querySelectorAll(".flow-block")),this.draggableBlocks.forEach(this.blockMouseDown)}var t,r,e;return t=n,(r=[{key:"blockMouseDown",value:function(t){var l,a=this,n=Pt(t,"mousedown").pipe(dt(function(t){return{startX:t.offsetX,startY:t.offsetY,original:t.target}}),Ct(function(t){var n,r,e,o,i=t.startX,u=t.startY,c=t.original.closest(".flow-block"),s=(n=c.cloneNode(!0),r=document.createElement("div"),e=document.createElement("span"),o=document.createElement("span"),r.classList.add("flow-block"),e.classList.add("flow-block-point","top"),o.classList.add("flow-block-point","bottom"),r.appendChild(e),r.appendChild(n),r.appendChild(o),{wrapper:r,topPoint:e,bottomPoint:o}).wrapper;l=s;var a=i-c.offsetLeft,f=u-c.offsetTop;s.classList.add("temp-block"),s.style.left=i-a+"px",s.style.top=u-f+"px",s.id=Bt("B"),document.body.appendChild(s)})),r=Pt(document,"mousemove"),i=Pt(document,"mouseup").pipe(Ct(function(){if(U(a.canvas,l)){var t=N(a.canvas),n=t.left,r=t.top;i=n,u=r,c=(o=l).style.left.replace("px",""),s=o.style.top.replace("px",""),o.style.left=c-i+"px",o.style.top=s-u+"px",l.parentNode.removeChild(l),a.canvas.appendChild(l);var e={id:l.id,element:l,childrenLine:[],parentsLine:[],children:[],parents:[]};a.tempBlockList.push(e),a.handleTempBlcokDrag(e),a.handlePointDrag(e)}else l.parentNode.removeChild(l);var o,i,u,c,s}));n.pipe(kt(function(t){var e=t.startX,o=t.startY;return r.pipe(dt(function(t){var n=t.clientX,r=t.clientY;return{left:n-e,top:r-o}}),jt(i))})).subscribe(function(t){l.style.top=t.top+"px",l.style.left=t.left+"px"})}},{key:"handleTempBlcokDrag",value:function(t){var n,r,s=this,a=t.element,f=t.parentsLine,l=t.childrenLine,e=(t.parents,t.children,Pt(a,"mousedown")),i=Pt(document,"mouseup"),u=Pt(document,"mousemove");e.pipe((n=function(t){return!t.target.classList.contains("flow-block-point")},function(t){return t.lift(new At(n,r))}),kt(function(t){var e=t.offsetX,o=t.offsetY;return u.pipe(dt(function(t){var n=t.clientX,r=t.clientY;return{left:n-e,top:r-o}}),Ct(function(t){var o=t.left,i=t.top,n=N(s.canvas),u=n.left,c=n.top;f.forEach(function(n){var t=s.lineList.find(function(t){return t.id===n}),r=a.offsetWidth;t.to=[o+r/2-u,i-c],V(t.id,t.from[0],t.from[1],o+r/2-u,i-c)}),l.forEach(function(n){var t=s.lineList.find(function(t){return t.id===n}),r=a.offsetWidth,e=a.offsetHeight;t.from=[o+r/2-u,i+e-c],V(t.id,o+r/2-u,i+e-c,t.to[0],t.to[1])})}),jt(i))})).subscribe(function(t){var n=t.top,r=t.left,e=N(s.canvas),o=e.left,i=e.top;a.style.left=r-o+"px",a.style.top=n-i+"px"})}},{key:"handlePointDrag",value:function(t){var h=this,d=t.element,b=d.querySelector(".bottom"),n=Pt(b,"mousedown"),r=Pt(document,"mouseup").pipe(Ct(function(c){for(var t=Y(b),s=t.x,a=t.y,n=N(h.canvas),f=n.left,l=n.top,p=!1,r=function(n){var t,r,e,o,i=Y(h.tempBlockList[n].element.querySelector(".top"));if((t=c.clientX,r=c.clientY,e=i.x,o=i.y,Math.hypot(t-e,r-o))<50){V(h.currPathUUID,s-f,a-l,i.x-f,i.y-l),p=!0;var u={from:[s-f,a-l],to:[i.x-f,i.y-l],id:h.currPathUUID};return h.lineList.push(u),h.tempBlockList[n].parentsLine.push(h.currPathUUID),h.tempBlockList[n].parents.push(h.parentId),h.tempBlockList.forEach(function(t){t.element===d&&(t.childrenLine.push(h.currPathUUID),t.children.push(h.tempBlockList[n].element.id))}),"break"}},e=0;e<h.tempBlockList.length;e++){if("break"===r(e))break}p||z(h.currPathUUID)})),u=Pt(document,"mousemove");n.pipe(Ct(function(){h.currPathUUID=Bt("L"),h.parentId=d.id}),dt(function(t){return{offsetX:t.offsetX,offsetY:t.offsetY,id:h.currPathUUID}}),kt(function(t){var e=t.offsetX,o=t.offsetY,i=t.id;return u.pipe(dt(function(t){var n=t.clientX,r=t.clientY;return{left:n-e,top:r-o,id:i}}),jt(r))})).subscribe(function(t){var n=t.top,r=t.left,e=t.id,o=N(h.canvas),i=o.left,u=o.top,c=Y(b),s=c.x,a=c.y;V(e,s-i,a-u,r-i,n-u)})}},{key:"import",value:function(t){var n=this;this.canvas.innerHTML=t.html;var r=JSON.parse(t.blockList),e=JSON.parse(t.lineList);r=r.map(function(t){return i({},t,{element:document.getElementById(t.id)})}),this.lineList=e,(this.tempBlockList=r).map(function(t){n.handleTempBlcokDrag(t),n.handlePointDrag(t)})}}])&&o(t.prototype,r),e&&o(t,e),n}(),Vt={initSVG:H,drowBezierCurve:V,deleteLine:z,Flow:Mt,initFlowy:Ut};t.default=Vt,t.initFlowy=Ut,Object.defineProperty(t,"__esModule",{value:!0})});
